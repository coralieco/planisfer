<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9&appId=1369013269801296";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


<div class="banner" style="background-image: linear-gradient(-225deg, rgba(0,101,168,0.6) 0%, rgba(0,36,61,0.6) 50%), url(<%= image_path("background.jpg") %>);">

  <div class = "row">
    <div class="non-logged-banner-title">
      <div class = 'container'>
        <div class = "col-xs-12 title-col">
          <span> <%= link_to root_path do %>
            <%= image_tag "logo_no_word.png", class: "logo"%>
          <% end %> </span>
          <span class ="brand-name white">Planisfer</span>
          <span class = "banner2-title white">Explore the world your own way</span>
          <% if member_signed_in? %>

            <%= link_to destroy_member_session_path, method: :delete, class: 'log-out white' do %>
              <i class="fa fa-sign-out"></i>  <%= t(".sign_out", default: "Log out") %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>




  <div class = "container">

    <div class = "row">

      <div class = "col-md-7">
        <%= render 'devise/shared/membership_main_text' %>
      </div>

      <div class = "col-md-4 col-md-offset-1">

        <div class="sticky-form" id = "member-form">
          <div class="tabs">
            <a class="tab <%= 'active' unless params[:referrer] %>" href="#" id="log-in-tab">
              <h4>Log in</h4>
            </a>
            <a class="tab <%= 'active' if params[:referrer] %>" href="#" id="sign-up-tab">
              <h4>Become a member</h4>
            </a>
          </div>

            <%= render 'shared/flashes' %>

          <div class = 'form-post referral-form-post light-opacity <%= 'hidden' unless params[:referrer] %>' id = 'referral-form'>
            <%= form_tag check_referrer_path, method: :get do %>
              <div class = 'referral-form-text member-input text-center'>
                <p> Planisfer is a club of travelers who share a passion for exploring the world</p>
                <p>You need to be referred by an existing member to join</p>
              </div>
              <div class="form-inputs referrer-input">
                <% if flash[:referrer_error] %>
                  <p class="red-message member-input text-center no-referral"><%= flash[:referrer_error] %></p>
                <% end %>
                <%= text_field_tag :email, nil, placeholder: "Your referrer's email", "class" => 'form-control member-input'%>
              </div>

              <div class="form-actions">
                <%= submit_tag "Confirm", class: 'btn-brand member-btn referral-btn' %>
              </div>

              <div class = 'facebook-form-text member-input text-center'>
                <p>
                Looking for a referrer? </p>
                <p>
                Ask your Facebook friends if they use Planisfer</p>
                <div class="fb-login-button facebook-button" data-href="http://www.planisfer.space/" data-layout="button" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore btn-brand facebook-link" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.planisfer.space%2F&amp"><i class="fa fa-facebook facebook-logo" aria-hidden="true"></i>Ask for a referrer</a></div>
              </div>

            <% end %>
          </div>

          <div class="form-post member-form-post light-opacity text-center <%= 'hidden' if params[:referrer] %>" id = 'sign-in-form'>

            <%= simple_form_for(resource, as: resource_name, url: session_path(resource_name)) do |f| %>
              <%= link_to member_facebook_omniauth_authorize_path do%>
                <div class="fb-login-button" data-width="324" data-max-rows="1" data-size="large" data-button-type="continue_with" data-show-faces="true" data-auto-logout-link="false" data-use-continue-as="false"></div>
              <% end %>
              <div class = separator_with_text> or</div>
              <div class="form-inputs">
                <%= f.input :email, required: false, autofocus: true, label: false, placeholder: 'Email', :input_html => { :class => 'form-control member-input' } %>
                <%= f.input :password, required: false, label: false, placeholder: 'Password', :input_html => { :class => 'form-control member-input' } %>
              </div>

              <div class="form-actions">
                <%= f.submit "Log in", class: 'btn-brand member-btn' %>
              </div>
            <% end %>
          </div> <!-- fin du form-post -->

        </div> <!-- fin de sticky-form -->
      </div>
    </div>


    <div class = "row bottom-row">
      <div class = "col-md-12 text-center">
        <%= render 'devise/shared/explore_link' %>
      </div>
    </div>

  </div>

</div>

  <div class = 'container'>
    <div class = "row">
      <div class="col-md-8">
        <%= render 'shared/destinations'%>
      </div> <!-- fin du 2e col-xs-12 principal -->
    </div>
  </div>

  <% for num in (0..Region.count - 1) %>
    <%= render 'pages/slider', this_region: Region.all[num], modal_name: "modal_#{num +1}" %>
  <% end %>



<% content_for(:after_js) do %>

  <!-- <script>
    // This is called with the results from FB.getLoginStatus().
    function statusChangeCallback(response) {
      console.log('statusChangeCallback');
      console.log(response);
      // The response object is returned with a status field that lets the
      // app know the current login status of the person.
      // Full docs on the response object can be found in the documentation
      // for FB.getLoginStatus().
      if (response.status === 'connected') {
        // Logged into your app and Facebook.
        testAPI();
      } else {
        // The person is not logged into your app or we are unable to tell.
        document.getElementById('status').innerHTML = 'Please log ' +
          'into this app.';
      }
    }

    // This function is called when someone finishes with the Login
    // Button.  See the onlogin handler attached to it in the sample
    // code below.
    function checkLoginState() {
      FB.getLoginStatus(function(response) {
        statusChangeCallback(response);
      });
    }

    window.fbAsyncInit = function() {
    FB.init({
      appId      : '1694430374184059',
      cookie     : true,  // enable cookies to allow the server to access
                          // the session
      xfbml      : true,  // parse social plugins on this page
      version    : 'v2.8' // use graph api version 2.8
    });

    // Now that we've initialized the JavaScript SDK, we call
    // FB.getLoginStatus().  This function gets the state of the
    // person visiting this page and can return one of three states to
    // the callback you provide.  They can be:
    //
    // 1. Logged into your app ('connected')
    // 2. Logged into Facebook, but not your app ('not_authorized')
    // 3. Not logged into Facebook and can't tell if they are logged into
    //    your app or not.
    //
    // These three cases are handled in the callback function.

    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });

    };

    // Load the SDK asynchronously
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    // Here we run a very simple test of the Graph API after login is
    // successful.  See statusChangeCallback() for when this call is made.
    function testAPI() {
      console.log('Welcome!  Fetching your information.... ');
      FB.api('/me', function(response) {
        console.log('Successful login for: ' + response.name);
        document.getElementById('status').innerHTML =
          'Thanks for logging in, ' + response.name + '!';
      });
    }
  </script> -->

  <script>
    $(document).ready(function() {
      $('.facebook-link').click(function(e) {
          e.preventDefault();
          window.open($(this).attr('href'), 'fbShareWindow', 'height=450, width=550, top=' + ($(window).height() / 2 - 275) + ', left=' + ($(window).width() / 2 - 225) + ', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');
          return false;
      });
    });
  </script>



  <script>
     $(document).ready(function() {
      $('#sign-up-tab').on('click', function(e) {
        e.preventDefault();
        $('#log-in-tab').removeClass('active');
        $(this).addClass('active');
        $('#referral-form').removeClass('hidden');
        $('#sign-in-form').addClass('hidden');
      })
      $('#log-in-tab').on('click', function(e) {
        e.preventDefault();
        $('#sign-up-tab').removeClass('active');
        $(this).addClass('active');
        $('#sign-in-form').removeClass('hidden');
        $('#referral-form').addClass('hidden');
      })
     })
  </script>

  <script>
    $(document).ready(function() {
      if($(window).width() <= 1024){
        $('.lg').removeClass('lg');
        $('sticky-form').removeClass('sticky-form');
      }
    })
  </script>

<% end %>

