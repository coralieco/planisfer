<div class="page-banner text-center">
  <div class="page-banner-title">
    <div class = "col-md-12 title-col">
      <span> <%= link_to root_path do %>
        <%= image_tag "blue_logo_no_word.png", class: "logo"%>
      <% end %> </span>
      <span class ="brand-name">Planisfer</span>
      <div class = "banner2-title-flexbox">
        <span class = "banner2-title">Build your traveler's profile... </span> </span> <span class = "banner2-title" id = "profile-banner2-title">and get personalized travel suggestions </span>
      </div>
    </div>
  </div>
  <span class = "booking-status text-desktop">
    <%= render 'shared/booking_status', :status => 0 %>
  </span>
</div>


<div class="container-fluid page-result">

  <div class="col-xs-12 col-md-9 right-border">

    <div class = 'row'>
      <div class = 'col-xs-12 text-center'>
        <h2 id = "profile-page-build">
          Build your traveler's profile
        </h2>
      </div>
    </div>

    <div class = 'row'>

      <div class = 'col-xs-12 col-md-3'>
        <div class = 'row'>
          <% @experiences.each_with_index do |experience, index| %>
            <div class = 'col-xs-12'>
              <a class="block profile-page-block destination <%= "active" if index == 0 %> <%= "dezoom" unless index == 0 %>">
                <%= image_tag "countryphoto/#{experience.region.name.downcase.delete(' ')}.jpg", class:"dest-image"%>
                <span class="box">
                  <span class="text in-box">
                    <span class="primarytext"><%= experience.region.name %></span>
                  </span>
                </span>
              </a>
            </div>
          <% end %>
        </div>
      </div>

      <div class = 'col-xs-12 col-md-9'>

        <div class = 'row'>
          <div class = 'col-xs-12'>
            <div class = 'selection-title'>
              <i class="fa fa-caret-right" aria-hidden="true"></i>
              <h4>Which cities did you like/ did not like?</h4>
            </div>
          </div>
        </div>

        <% (0..@nb_rows - 2).each do |index| %>

          <div class = "row">

            <div class = 'col-xs-12 col-md-3 subexp-card-height'>
              <div class = "subexperience-card-container <%= 'subexp-opacity' unless index == 0%>" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url(<%= image_path("#{@region.name.downcase.gsub(/\ /, '-')}/#{@pois_hash[index][0].name.downcase.gsub(/\ /, '-')}.jpg") %>);" data-poi-id = <%= @pois_hash[index][0].id %> >
                <div class="subexperience-name text-center">
                  <h2><%= @pois_hash[index][0].name %></h2>
                </div>
              </div>

            </div>

            <div class = 'col-xs-12 col-md-6'>
              <%= render 'subexp_feedback_form', poi_id: @pois_hash[index][0].id %>
              <%= render 'subexp_feedback_form', poi_id: @pois_hash[index][1].id %>
            </div>

            <div class = 'col-xs-12 col-md-3 subexp-card-height'>
              <div class = "subexperience-card-container subexp-opacity" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url(<%= image_path("#{@region.name.downcase.gsub(/\ /, '-')}/#{@pois_hash[index][1].name.downcase.gsub(/\ /, '-')}.jpg") %>);" data-poi-id = <%= @pois_hash[index][1].id %> >
                <div class="subexperience-name text-center">
                  <h2><%= @pois_hash[index][1].name %></h2>
                </div>
              </div>

            </div>

          </div>

        <% end %>

        <div class = "row">
          <div class = 'col-xs-12 col-md-3 subexp-card-height'>
            <div class = "subexperience-card-container subexp-opacity" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url(<%= image_path("#{@region.name.downcase.gsub(/\ /, '-')}/#{@pois_hash[@nb_rows-1][0].name.downcase.gsub(/\ /, '-')}.jpg") %>);" data-poi-id = <%= @pois_hash[@nb_rows-1][0].id %> >
              <div class="subexperience-name text-center">
                <h2><%= @pois_hash[@nb_rows-1][0].name %></h2>
              </div>
            </div>

          </div>

          <div class = 'col-xs-12 col-md-6'>
            <%= render 'subexp_feedback_form', poi_id: @pois_hash[@nb_rows-1][0].id %>
            <% if @even_pois %>
              <%= render 'subexp_feedback_form', poi_id: @pois_hash[@nb_rows-1][1].id  %>
            <% end %>
          </div>

          <% if @even_pois %>

            <div class = 'col-xs-12 col-md-3 subexp-card-height'>
              <div class = "subexperience-card-container subexp-opacity" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url(<%= image_path("#{@region.name.downcase.gsub(/\ /, '-')}/#{@pois_hash[@nb_rows-1][1].name.downcase.gsub(/\ /, '-')}.jpg") %>);" data-poi-id = <%= @pois_hash[@nb_rows-1][1].id %> >
                <div class="subexperience-name text-center">
                  <h2><%= @pois_hash[@nb_rows-1][1].name %></h2>
                </div>
              </div>

            </div>

          <% end %>

        </div>

      </div>
    </div>


  </div>

  <div class="col-xs-12 col-md-3">
    <%= render 'shared/recommendations' %>
  </div>

</div>


<%= content_for :after_js do %>

  <script>

    $(document).ready(function() {
      var firstPoiId = '<%= @pois_hash[0][0].id %>';
      console.log(firstPoiId);
      $('#' + firstPoiId).removeClass('hidden');

      $('.subexperience-card-container').mouseenter(function() {
        console.log('test');
        $('.subexperience-card-container').addClass('subexp-opacity');
        $(this).removeClass('subexp-opacity');
        $('.feedback-form').addClass('hidden');
        var poiId = $(this).data('poi-id');
        console.log(poiId);
        $('#' + poiId).removeClass('hidden');
      })
      // $('.subexperience-card-container').mouseleave(function() {
      //   var poiId = $(this).data('poi-id');
      //   $('#' + poiId).addClass('hidden');
      // })
    })

  </script>

<% end %>


